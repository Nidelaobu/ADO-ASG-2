CREATE OR REPLACE VIEW VW_TIME_SERIES_ANALYSIS AS
SELECT
l.LOCATION_ID,
l.COUNTRY_NAME,
d.YEAR_ID,
e.population,
e.gdp,
el.GHG_EMISSIONS,
r.TOTAL_CONSUMPTION AS RENEWABLE_CONSUMPTION,
r.TOTAL_SHARE       AS RENEWABLE_SHARE,
f.TOTAL_CONSUMPTION AS FOSSIL_CONSUMPTION,
f.TOTAL_SHARE       AS FOSSIL_SHARE
FROM DIM_LOCATION l
JOIN FACT_ECONOMY e
ON l.LOCATION_ID = e.LOCATION_ID
JOIN DIM_DATE d
ON e.YEAR_ID = d.YEAR_ID
LEFT JOIN FACT_ELECTRICITY el
ON l.LOCATION_ID = el.LOCATION_ID
AND d.YEAR_ID = el.YEAR_ID
LEFT JOIN FACT_RENEWABLES_TOTAL r
ON l.LOCATION_ID = r.LOCATION_ID
AND d.YEAR_ID = r.YEAR_ID
LEFT JOIN FACT_FOSSIL_TOTAL f
ON l.LOCATION_ID = f.LOCATION_ID
AND d.YEAR_ID = f.YEAR_ID;
SELECT
COUNTRY_NAME,
YEAR_ID,
GHG_EMISSIONS
FROM VW_TIME_SERIES_ANALYSIS
ORDER BY COUNTRY_NAME, YEAR_ID;

SELECT
YEAR_ID,
SUM(GHG_EMISSIONS) AS GLOBAL_GHG_EMISSIONS
FROM VW_TIME_SERIES_ANALYSIS
GROUP BY YEAR_ID
ORDER BY YEAR_ID;

SELECT
COUNTRY_NAME,
CASE
WHEN YEAR_ID < 2020 THEN 'Pre-COVID'
ELSE 'Post-COVID'
END AS PERIOD,
AVG(GHG_EMISSIONS) AS AVG_EMISSIONS,
AVG(RENEWABLE_SHARE) AS AVG_RENEWABLE_SHARE
FROM VW_TIME_SERIES_ANALYSIS
GROUP BY COUNTRY_NAME, PERIOD
ORDER BY COUNTRY_NAME, PERIOD;
